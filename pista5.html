<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caça ao Tesouro - Pista 5</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<style>
  .progress-bar {
    width: 100%;
    height: 8px;
    background-color: #e0e0e0;
    border-radius: 4px;
    margin: 20px 0;
    overflow: hidden;
}

.progress {
    height: 100%;
    width: 62.5%; /* Pista 5 de 8 (se quiseres até 8, ajusta conforme total) */
    background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    border-radius: 4px;
    transition: width 0.5s ease;
}
</style>
<body>
    <div class="container">
        <h1>Caça ao Tesouro</h1>
        
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
        
        <div class="pista-card">
            <p class="pista-text">
                Sou lugar de ideias e planos mil,<br>
                onde cada caminho ganha um perfil.<br>
                Nem sou sala de aula, nem sou refeitório,<br>
                mas em mim se traça todo diretório.
            </p>
        </div>

        <div class="resposta-section" id="respostaSection">
            <p class="instrucao" id="instrucao">Escreve o nome do local para desbloquear o scanner:</p>
            
            <div class="input-group">
                <input type="text" id="resposta" placeholder="Nome do local" />
                <button id="verificar">
                    <span>Verificar</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            
            <div class="feedback" id="feedback"></div>
        </div>

        <div class="scanner-section" id="scannerSection">
            <h2 class="scanner-title">Scanner QR Code</h2>
            <p>Aponta a câmara para o código QR para avançar para a próxima pista.</p>
            <div id="reader"></div>
        </div>
    </div>

    <footer>
        Caça ao Tesouro - Pista 5
    </footer>

    <script>
        const respostaCorreta = "núcleo"; // Nome correto em minúsculas
        const verificarBtn = document.getElementById("verificar");
        const scannerSection = document.getElementById("scannerSection");
        const respostaSection = document.getElementById("respostaSection");
        const inputResposta = document.getElementById("resposta");
        const instrucao = document.getElementById("instrucao");
        const feedback = document.getElementById("feedback");

        verificarBtn.addEventListener("click", verificarResposta);
        inputResposta.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                verificarResposta();
            }
        });

        function verificarResposta() {
            const respostaUsuario = inputResposta.value.toLowerCase().trim();
            feedback.style.display = "none";
            
            if (respostaUsuario === "") {
                mostrarFeedback("Por favor, insira uma resposta.", "error");
                return;
            }
            
            if (respostaUsuario === respostaCorreta) {
                mostrarFeedback("Resposta correta! Agora você pode escanear o QR code.", "success");
                
                setTimeout(() => {
                    respostaSection.style.display = "none";
                    scannerSection.style.display = "block";
                    
                    const html5QrcodeScanner = new Html5QrcodeScanner(
                        "reader", { 
                            fps: 10, 
                            qrbox: 250,
                            aspectRatio: 1.0
                        });
                    
                    html5QrcodeScanner.render((decodedText, decodedResult) => {
                        document.body.style.opacity = "0.7";
                        setTimeout(() => {
                            window.location.href = decodedText;
                        }, 500);
                    }, (error) => {
                        console.log(`Erro no scanner: ${error}`);
                    });
                }, 1500);
            } else {
                mostrarFeedback("Resposta incorreta! Tente novamente.", "error");
                inputResposta.style.animation = "shake 0.5s";
                setTimeout(() => {
                    inputResposta.style.animation = "";
                }, 500);
            }
        }

        function mostrarFeedback(mensagem, tipo) {
            feedback.textContent = mensagem;
            feedback.className = "feedback " + tipo;
            feedback.style.display = "block";
            feedback.style.animation = "fadeIn 0.3s ease";
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>